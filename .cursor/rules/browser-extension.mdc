---
alwaysApply: true
---

# Browser Extension Development Guidelines

## Extension Configuration (WXT Framework)
- **WXT Config**: Use `wxt.config.ts` for all extension configuration
- **Manifest**: WXT automatically generates manifest files for different browsers
- **Permissions**: Request minimal permissions in wxt.config.ts manifest section
- **CSP**: Configure Content Security Policy in wxt.config.ts
- **Modules**: Use WXT modules like @wxt-dev/module-react for React integration

## Communication & Storage
- **Message Passing**: Use proper message passing between background, content, and popup scripts
- **Storage**: Use browser.storage.sync for user preferences, browser.storage.local for cache
- **Event Handling**: Implement proper cleanup for event listeners
- **Navigation**: Handle page navigation and dynamic content loading

## Cross-browser Compatibility
- Use `webextension-polyfill` for API consistency across browsers
- Avoid browser-specific APIs unless absolutely necessary
- Test manifest v3 compatibility (Chrome/Edge) and v2 fallbacks (Firefox/Safari)
- Validate all inter-script communications

## Content Script Best Practices
- Minimize content script impact on page performance
- Use efficient DOM querying strategies
- Use requestIdleCallback for non-critical operations
- Implement proper cleanup in useEffect for content scripts